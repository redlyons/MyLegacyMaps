@model MyLegacyMaps.Models.AdoptedMap

@{
    ViewBag.Title = "Adopted Map";
    var flagElem = "\"<div class='makeMeDraggable {0} masterTooltip' data-xpos='{1}' data-ypos='{2}' " +
                         "data-flagtypeid={3} data-flagId={4} style='{5}' title='Name: {6} Date: {7} ' ></div>\"";                        
}

@section Scripts{      
    @Scripts.Render("~/bundles/jqueryui")
    @Scripts.Render("~/bundles/mlm")
}

@using (Html.BeginForm(null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" }))
{
    @Html.AntiForgeryToken();
    @Html.Hidden("adoptedMapId", Model.AdoptedMapId);
    @Html.Hidden("mapImageUrl", Model.Map.GetMainImageUrl())
    @Html.Hidden("mapOrientation", Model.Map.OrientationTypeId)
    @Html.AntiForgeryToken()
}

@Html.Partial("~/Views/Shared/Partials/MapCanvas.cshtml")
<h2>@Html.DisplayFor(model => Model.Name)</h2>
<p> @Html.DisplayFor(model => model.Description)</p>


<script type="text/javascript">
    $(document).ready(function () {
        @foreach(var flag in @Model.Flags)
        {                        
            var elem =
                String.Format(flagElem,
                              flag.GetCssClass(),
                              flag.Xpos,
                              flag.Ypos,
                              flag.FlagTypeId,
                              flag.FlagId,
                              flag.GetStyle(),
                              @Html.AttributeEncode(flag.Name),
                              (flag.Date.HasValue)? flag.Date.Value.ToShortDateString() : "");
           
            @Html.Raw(String.Format("$('#content').append({0}); MLM.MapCanvas.wireUpFlags();", elem));
        }
    });
</script>





